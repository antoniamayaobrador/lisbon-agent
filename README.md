# Geospatial AI Agent for Real Estate

## Project Overview

This project is a proof-of-concept for a **Geospatial AI Agent** designed to expand how we interact with urban data. It serves as a testbed for integrating Large Language Models (LLMs) with geospatial analysis tools, specifically targeting the **Real Estate** sector.

The core mission is to bridge the gap between complex geospatial data (GeoJSONs, street networks, administrative boundaries) and natural language questions. Instead of writing SQL or Python code, a user can simply ask: *"Where is the cheapest apartment near a metro station?"* and the agent handles the rest.

## Business Case

In the competitive real estate market, location is everything. However, location data is often siloed and difficult to analyze without technical expertise. This agent demonstrates how AI can:
-   **Democratize Data Access**: Allow non-technical stakeholders (agents, investors) to query complex datasets.
-   **Accelerate Decision Making**: Instantly answer proximity and affordability questions.
-   **Uncover Hidden Insights**: correlate noise levels, transport accessibility, and housing prices dynamically.

## What's the Agentic interest of this project?

-   **Autonomous Reasoning**: It doesn't just look up data; it *plans* an analysis. If you ask for specific streets, it knows to fetch fresh data from OpenStreetMap.
-   **Tool-Use Capabilities**: It leverages a suite of specialized tools (`geopandas`, `osmnx`) to perform rigorous spatial operations (joins, nearest neighbor searches) rather than hallucinating answers.
-   **Synthetic Data Engine**: Includes a robust generator for synthetic housing data, complete with realistic pricing models and real street addresses, enabling stress-free testing and demonstrations.
-   **Visual Output**: Capable of generating plots and maps on the fly to visualize trends and locations.

## Data Sources

The accuracy of this agent relies on a blend of high-quality data sources:
1.  **OpenStreetMap (OSM)**: Used for live street networks, amenities, and walking paths (accessed via `osmnx`).
2.  **Official Government Data**: Administrative boundaries and public service locations sourced from Portuguese open data portals (e.g., *dados.gov.pt*, *Lisboa Aberta*).
3.  **Synthetic Data**: A generated dataset of residential properties (`synthetic_houses.geojson`) designed to mimic real market conditions, providing safe test data for proximity and pricing analysis.

## Agentic Capabilities: Improving RAG

This project goes beyond simple Retrieval-Augmented Generation (RAG). In a standard RAG system, the AI retrieves documents and summarizes them. In this **Agentic RAG** system, the LLM acts as an autonomous reasoner:
1.  **Iterative Planning**: It breaks down complex queries (e.g., "Find the cheapest house near a park and check reviews") into multiple steps.
2.  **Tool Selection**: It decides *which* tool to use. If it needs reviews, it searches the web. If it needs spatial analysis, it uses `geopandas`.
3.  **Self-Correction**: It checks the output of its tools. If a retrieval comes up empty, it rephrases the search or tries a different dataset.
4.  **Multi-Modal**: It combines text, structured data (GeoJSON), and images (plots) into a cohesive answer.

## Toolbox

The agent is equipped with a suite of Python-based tools, defined in `Agent/tools.py`. Here is how they work:

-   `load_geojson(file_path)`:
    -   **Purpose**: Inspects a dataset before using it.
    -   **How it works**: Uses `geopandas.read_file()` to return a summary of columns, CRS, and geometry types, preventing blind aggregation errors.

-   `spatial_join(left, right, how, predicate)`:
    -   **Purpose**: Filters data based on location (e.g., "restaurants in Avenidas Novas").
    -   **How it works**: Performs a `gpd.sjoin()` operation. It matches geometries (Points within Polygons) to create a new dataset linking features from both inputs.

-   `find_nearest(source, target, k)`:
    -   **Purpose**: Proximity analysis (e.g., "closest bus stop").
    -   **How it works**: Uses `scipy.spatial.cKDTree` (via geopandas) or `sjoin_nearest` to calculate Euclidean distances. It automatically handles CRS projection (EPSG:3857) to ensure accurate meter-based measurements.

-   `get_street_network(place, network_type)`:
    -   **Purpose**: Fetch fresh street data.
    -   **How it works**: Wraps the **OSMnx** library. It calls `ox.graph_from_place()` to download the live graph from OpenStreetMap, converts it to a GeoDataFrame of edges, and saves it for analysis.

-   `web_search(query)`:
    -   **Purpose**: Find real-time or qualitative info (reviews, ratings).
    -   **How it works**: Uses `duckduckgo-search` to perform an anonymous web query and returns the text snippets from top results.

-   `analyze_data(file_path, python_code)`:
    -   **Purpose**: Infinite flexibility.
    -   **How it works**: Executes sandboxed Python code generated by the agent. It can use `pandas` for aggregation (mean, sum) or `matplotlib` for plotting. It creates and saves plots to `data/plots/` automatically.


## Future Roadmap

To evolve this from a prototype to a production-ready system, the following features are envisioned:
-   **3D Visualization**: Integrate with Cesium or Mapbox GL for immersive 3D city views.
-   **Real-Time Data**: Connect to live APIs for transit schedules, traffic, and real estate listings.
-   **Predictive Modeling**: Incorporate scikit-learn models to predict future property prices based on urban indicators.
-   **Multi-Modal Inputs**: Allow users to upload their own GeoJSONs or images of maps for analysis.

---

## Technical Setup & Usage

### 1. Installation
```bash
pip install -r requirements.txt
pip install osmnx
```

### 2. Configuration
Create a `.env` file in the root directory.

**Required API Keys:**
-   `OPENAI_API_KEY`: Required for the agent to function (GPT-4o).

```bash
OPENAI_API_KEY=sk-...
```

### 3. Data Ingestion
Initialize the knowledge base:
```bash
python -m Agent.rag
```

### 4. Running the Agent
Launch the web interface:
```bash
python -m Agent.interface
```
Access at `http://localhost:7860`.

### 5. Synthetic Data Tools
-   **Generate Houses**: `python generate_houses.py`
-   **Add Addresses**: `python add_addresses.py`

## Architecture
-   **LangGraph**: Orchestrates the decision-making loop.
-   **ChromaDB**: Vector store for dataset metadata.
-   **OSMnx**: Street network data provider.
-   **Gradio**: Frontend interface.
